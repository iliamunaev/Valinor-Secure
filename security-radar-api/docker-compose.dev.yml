version: '3.8'

# Development configuration with hot reload
# Usage: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
      target: builder  # Use builder stage for development dependencies
    image: ai-security-assessor:dev
    container_name: assessor-api-dev
    ports:
      - "8088:8088"
    environment:
      - APP_NAME=AI Security Assessor (Dev)
      - API_HOST=0.0.0.0
      - API_PORT=8088
      - DEBUG=True
      - CACHE_DB_PATH=/app/data/assessment_cache.db
    volumes:
      # Mount source code for hot reload
      - ./src:/app/src:ro
      - ./main.py:/app/main.py:ro
      - ./requirements.txt:/app/requirements.txt:ro
      # Persist cache database
      - ./data:/app/data
      # Mount .env file
      - ./.env:/app/.env:ro
    command: uvicorn src.main:app --host 0.0.0.0 --port 8088 --reload
    restart: unless-stopped
    networks:
      - assessor-network

networks:
  assessor-network:
    driver: bridge
